#' ## Descargar datos OG
library(rwos)
library(rwos.udc)
wosdf <- wos_ImportSources('./UDC_2008-2017 (01-02-2019)', other = FALSE)
db <- wos_CreateDB(wosdf)
save(db, file = 'wos_udc_og.RData')

# Añadir información JCR a wos.db
load('jcr.list.RData')
load('wos_udc_og.RData')
db_udc <- wos_AddJCR(db, jcr.list)
db_udc$label <-"UDC"
save(db_udc, file = 'wos_udc_og_jcr.RData')


#' ## Cargar datos depurados biblioteca
library(openxlsx)
wosdf2 <- readWorkbook('Registros_WOS_IUNE_2008_2017.xlsx')
UT.biblio <- wosdf2$UT

#' ## Comparar y guardar diferencias
index <- wosdf$UT %in% UT.biblio

#' Registros con OG pero no en biblioteca
library(xlsx)
sum(!index)
write.xlsx(wosdf[!index, ], file = 'nobiblio.xlsx')

#' Registros con OG y en biblioteca
sum(index)

#' Busqueda registros en biblioteca pero no OG
index2 <-UT.biblio %in% wosdf$UT
sum(!index2)
# Hay 11 que no tienen código WOS
cat(paste( UT.biblio[!index2], collapse = ' OR '), file = 'busqueda_wos.txt') 
# Busqueda en Wos con nº de acceso y guardar en savedrecs_noog.txt
wosdf3 <- wos_ImportSources(".", "savedrecs_noog.txt", other = FALSE)

wosdf4 <- rbind(wosdf[index, ], wosdf3)
db <- wos_CreateDB(wosdf4)
save(db, file = 'wos_udc.RData')

# Añadir información JCR a wos.db
load("../_JCR/jcr.list.RData")
source("../_JCR/JCR.R")
db_udc <- wos_AddJCR(db, jcr.list)
save(db_udc, file = 'wos_udc_jcr.RData')



